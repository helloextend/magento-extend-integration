<?php
$viewModel = $block->getData('viewModel');

$extendStoreUuid = $viewModel->getExtendStoreUuid();
$activeEnvironment = $viewModel->getActiveEnvironment();

/** @var \Magento\Catalog\Model\Product $product */
$product = $block->getProduct();

/** replace whitespace as being used as a div id */
$normalizedProductSku = preg_replace('/\s+/', '_', $product->getSku());
$productPrice = $product->getPrice();

$categoryName = '';
if ($category = $product->getCategory()) {
    $categoryName = $category->getName();
}
?>

<div class="product_protection_modal_offer" id="product_protection_modal_offer_<?= $normalizedProductSku ?>"></div>

<script type="text/x-magento-init">
    {
        "#product_protection_modal_offer_<?= $normalizedProductSku ?>": {
            "productProtectionModalOffer": [
                {
                    "extendStoreUuid": "<?= $extendStoreUuid ?>",
                    "activeEnvironment": "<?= $activeEnvironment ?>",
                    "productSku": "<?= $normalizedProductSku ?>",
                    "productPrice": "<?= $productPrice ?>",
                    "productCategory": "<?= $categoryName ?>"
                }
            ]
        }
    }
</script>
