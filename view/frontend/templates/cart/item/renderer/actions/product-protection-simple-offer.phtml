<?php
/** @var \Magento\Quote\Model\Quote\Item $_item */
$item = $block->getItem();
/** @var \Magento\Catalog\Model\Product $product */
$product = $item->getProduct();

/** @var \Magento\Quote\Model\Quote $quote */
$quote = $_item->getQuote();

$productType = $product->getTypeId();
?>
<div>
    <span>Product Protection</span>        
    <div class="product-protection-offer" id="product_protection_offer_<?= product->getSku() ?>"></div>
</div>
<script type="text/x-magento-init">
    {
        "#product_protection_offer_<?= $block->getProduct()->getSku() ?>": {
            "simpleProductProtectionOffer": [
               {
                        "extendStoreUuid": "<?= $block
                            ->getData('viewModel')
                            ->getExtendStoreUuid() ?>",
                        "activeEnvironment": "<?= $block
                            ->getData('viewModel')
                            ->getActiveEnvironment() ?>",
                        "selectedProductSku": "<?= $product->getSku() ?>",
                        "selectedProductPrice": "<?= $product->getPrice() ?>",
                        "productCategory": "<?= $product->getCategory()->getName() ?>"
                    }
            ]
        }
    }
</script>
<script>
    document
        .querySelectorAll('#super-product-table tbody tr .price-box')
        .forEach((el, i) => {
            let id = el.getAttribute('data-price-box');
            if (document.querySelector('.' + id)) {
                el
                    .closest('tr')
                    .after(document.querySelector('.' + id).closest('tr'));
            }
        });
</script>
